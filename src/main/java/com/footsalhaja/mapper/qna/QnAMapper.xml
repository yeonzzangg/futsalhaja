<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.footsalhaja.mapper.qna.QnAMapper">

	<!-- Create QnABoard -->	 
	 <insert id="insertQnABoard" >
		 INSERT INTO QnABoard 
		 		(  category,   title,    content , member_userId )
		 VALUES 
		 		(#{category}, #{title}, #{content}, #{userId}  );
	 </insert>
	 
	 <select id="myQnAList" resultType="com.footsalhaja.domain.qna.QnADto">
	 	SELECT 
	 		q.qnaId,
	 		q.category,
	 		q.title,
	 		q.content,
	 		q.status,
	 		m.userId,
	 		m.nickName
	 	FROM 
	 	 	QnABoard q
	 	LEFT JOIN member m 
	 	ON q.member_userId = m.userId 	
	 	WHERE
	 		m.userId = #{userId}
	 	ORDER BY 
	 		qnaId DESC 
	 	LIMIT
	 		#{offset}, #{records}
	 </select>
	 
	 <select id="countAllQnAByUserId" resultType="int">
	 	SELECT 
	 		COUNT(*)
	 	FROM 
	 	 	QnABoard q
	 	LEFT JOIN member m 
	 	ON q.member_userId = m.userId 	
	 	WHERE
	 		m.userId = #{userId}
	 </select>
	 
	<select id="selectMyQnAListByUserId" resultType="com.footsalhaja.domain.qna.QnADto">
	 	SELECT 
	 		qnaId, category, title, content, status, member_userId, member_nickName
	 	FROM 
	 	 	QnABoard
	 	WHERE 
	 		member_userId = #{userId} 
	 	ORDER BY 
	 		qnaId DESC 
	</select>

	<select id="selectMyQnAGetByQnAIdAndUserId" resultType="com.footsalhaja.domain.qna.QnADto">
		SELECT 
	 		q.qnaId,
	 		q.category,
	 		q.title,
	 		q.content,
	 		q.status,
	 		q.insertDatetime,
	 		m.userId
	 	FROM 
	 	 	QnABoard q
	 	LEFT JOIN 
	 		member m
	 	ON 
	 		q.member_userId = m.userId
	 	WHERE 
	 		m.userId = #{userId} AND q.qnaId = #{qnaId}
	 	
	</select>	
	
	
	<select id="selectFAQList" resultType="com.footsalhaja.domain.qna.FAQDto">
		SELECT 
			faqId,
			title,
			content
		FROM
			FAQ	
	</select>
	
	<select id="selectAllQnAList" resultType="com.footsalhaja.domain.qna.QnADto">
		SELECT 
	 		qnaId,
	 		category,
	 		title,
	 		content,
	 		status,
	 		member_userId AS userId,
	 		likeCount
	 	FROM 
	 	 	QnABoard
	 	WHERE
		<trim prefixOverrides="OR">
			<if test="type == 'all' or type == 'title'">
			OR title LIKE #{keyword}
			</if>
			
			<if test="type == 'all' or type == 'content'">
			OR content LIKE #{keyword}
			</if>
			
			<if test="type == 'all' or type == 'userId'">
			OR member_userId LIKE #{keyword}
			</if>
		</trim>  	
	 	ORDER BY qnaId DESC
	 	LIMIT #{offset}, #{records}
	</select>
	<select id="countAllQnA" resultType="int">
		SELECT 
	 		COUNT(*)
	 	FROM 
	 	 	QnABoard 
	 	WHERE
		<trim prefixOverrides="OR">
			<if test="type == 'all' or type == 'title'">
			OR title LIKE #{keyword}
			</if>
			
			<if test="type == 'all' or type == 'content'">
			OR content LIKE #{keyword}
			</if>
			
			<if test="type == 'all' or type == 'userId'">
			OR member_userId LIKE #{keyword}
			</if>
		</trim> 	
	</select>
	
	<!-- 좋아요 기능추가  -->
	<select id="selectQnABoardLikeCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			QnABoardLike
		WHERE 
			qnaId = #{qnaId} AND userId = #{loggedinId}
	</select>
	<insert id="insertQnABoardLikeCount">
		INSERT INTO QnABoardLike (qnaId, userId)
		VALUES (#{qnaId}, #{loggedinId})
	</insert>
	<delete id="deleteQnABoardLikeCount">
		DELETE FROM QnABoardLike
		WHERE qnaId = #{qnaId} AND userId = #{loggedinId}
	</delete>
	
	<insert id="insertQnAReply">
		<!-- //qnaReplyId,qnaId,userId,writer,content,insertDatetime -->
		INSERT INTO QnAReply (qnaId, userId, writer, content)
		VALUES( #{qnaId}, #{userId}, #{writer}, #{content} )
	</insert>
	<select id="selectQnAReply" resultType="com.footsalhaja.domain.qna.QnAReplyDto">
		<!-- //qnaReplyId,qnaId,userId,writer,content,insertDatetime -->
		SELECT qnaReplyId,qnaId,userId,writer,content,insertDatetime
		FROM QnAReply
		WHERE qnaId = #{qnaId}
	</select>
	
	<insert id="insertQnAReplyToAnswer">
		<!-- //qnaReplyToAnswerId, qnaReplyId, qnaId, writer, content, userId, insertDatetime -->
		INSERT INTO QnAReplyToAnswer (qnaReplyId, qnaId, writer, content, userId)
		VALUES( #{qnaReplyId}, #{qnaId}, #{writer}, #{content}, #{userId} )
	</insert>
	<select id="selectQnAReplyToAnswerList" resultType="com.footsalhaja.domain.qna.QnAReplyToAnswerDto">
		<!-- //qnaReplyToAnswerId, qnaReplyId, qnaId, writer, content, userId, insertDatetime -->
		SELECT qnaReplyToAnswerId, qnaReplyId, qnaId, writer, content, userId, insertDatetime
		FROM QnAReplyToAnswer
		WHERE qnaId = #{qnaId}
	</select>

 </mapper>